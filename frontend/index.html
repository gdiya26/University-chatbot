<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nirma University Chatbot - Modern UI</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Modern Reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color-start: #4A90E2;
            --primary-color-end: #50C878; 
            --primary-text-color: #1a1a1a;
            --secondary-text-color: #6c757d;
            --background-light: #f5f7fa;
            --background-white: #ffffff;
            --border-color: #e9ecef;
            --shadow-subtle: 0 4px 16px rgba(0, 0, 0, 0.1);
            --shadow-lift: 0 8px 25px rgba(0, 0, 0, 0.2);
            --border-radius-large: 18px;
            --border-radius-small: 10px;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            background-color: #f0f2f5; /* Subtle page background */
        }

        /* --- Chat Button --- */
        #chatbot-button {
            position: fixed;
            bottom: 30px; /* Increased distance from bottom/right */
            right: 30px;
            width: 64px; /* Slightly larger */
            height: 64px;
            border-radius: 50%;
            /* Updated, fresh gradient */
            background: linear-gradient(135deg, var(--primary-color-start) 0%, var(--primary-color-end) 100%);
            border: none;
            cursor: pointer;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2); /* Deeper shadow for float effect */
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275), box-shadow 0.3s; /* Bounce transition */
            z-index: 1000;
        }

        #chatbot-button:hover {
            transform: scale(1.08);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
        }

        #chatbot-button svg {
            width: 32px; /* Slightly larger icon */
            height: 32px;
            fill: white;
        }

        /* --- Chat Widget Container --- */
        #chatbot-widget {
            position: fixed;
            bottom: 110px; /* Adjusted position */
            right: 30px;
            width: 360px; /* Slightly narrower for a cleaner look */
            height: 550px;
            background: var(--background-white);
            border-radius: var(--border-radius-large);
            box-shadow: var(--shadow-subtle);
            display: none;
            flex-direction: column;
            overflow: hidden;
            z-index: 999;
            animation: slideUp 0.3s ease-out;
            transform-origin: bottom right; /* New: for better animation origin */
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: scale(0.95) translateY(20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        /* --- Header --- */
        #chatbot-header {
            background: linear-gradient(90deg, var(--primary-color-start) 0%, var(--primary-color-end) 100%);
            color: white;
            padding: 18px 20px; /* Slightly refined padding */
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        #chatbot-header h3 {
            font-size: 17px;
            font-weight: 600; 
        }

        #chatbot-header p {
            font-size: 13px;
            opacity: 0.85;
            margin-top: 2px;
        }

        #close-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            line-height: 1; 
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }

        #close-btn:hover {
            background: rgba(255, 255, 255, 0.35);
        }

        /* --- Messages Container --- */
        #chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: var(--background-light); /* Lighter background for chat area */
            scroll-behavior: smooth;
        }

        /* Custom Scrollbar for a cleaner look (optional, but modern) */
        #chat-messages::-webkit-scrollbar {
            width: 6px;
        }

        #chat-messages::-webkit-scrollbar-thumb {
            background-color: #ced4da;
            border-radius: 10px;
        }

        .message {
            margin-bottom: 14px; /* Reduced margin */
            display: flex;
            animation: messageAppear 0.3s ease-out;
        }

        .message-avatar {
            width: 30px;
            height: 30px;
            background-color: var(--primary-color-start);
            border-radius: 50%;
            margin-right: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 14px;
            flex-shrink: 0;
            /* Bot icon (using a simple 'A' for Assistant or 'N' for Nirma) */
            content: 'A';
        }

        .message.user {
            justify-content: flex-end;
        }

        .message-content {
            max-width: 75%; /* Slightly more space for long messages */
            padding: 12px 16px;
            border-radius: var(--border-radius-small);
            line-height: 1.5;
            font-size: 14px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08); /* Softer message shadow */
            transition: all 0.2s ease;
        }

        .message.bot {
            align-items: flex-start; /* Align text nicely with avatar */
        }

        .message.bot .message-content {
            background: var(--background-white);
            color: var(--primary-text-color);
            border-bottom-left-radius: 4px;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #6c5ce7 0%, #a29bfe 100%); /* New user gradient */
            color: white;
            border-bottom-right-radius: 4px;
        }

        /* --- Typing Indicator --- */
        .typing-indicator {
            display: none;
            align-items: center;
            padding: 10px 14px;
            background: var(--background-white);
            border-radius: var(--border-radius-small);
            border-bottom-left-radius: 4px;
            width: fit-content;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
            margin-bottom: 14px;
        }

        .typing-indicator span {
            display: inline-block;
            width: 7px;
            height: 7px;
            background: #adb5bd; /* Subtle grey dots */
            border-radius: 50%;
            margin: 0 3px;
            animation: typing 1.2s infinite ease-in-out;
        }

        /* --- Input Container --- */
        #chat-input-container {
            padding: 12px 16px; /* Refined padding */
            background: var(--background-white);
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 10px;
        }

        #chat-input {
            flex: 1;
            padding: 10px 18px;
            border: 1px solid var(--border-color);
            border-radius: 20px; /* More rounded */
            font-size: 14px;
            color: var(--primary-text-color);
            outline: none;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        #chat-input::placeholder {
            color: var(--secondary-text-color);
            opacity: 0.8;
        }

        #chat-input:focus {
            border-color: var(--primary-color-start);
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.2); /* Focus ring effect */
        }

        #send-btn {
            width: 40px; /* Slightly smaller, more balanced */
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color-start) 0%, var(--primary-color-end) 100%);
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s, opacity 0.2s;
        }

        #send-btn:not(:disabled):hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        #send-btn:disabled {
            background: #ced4da; /* Greyed out when disabled */
            opacity: 0.8;
            cursor: not-allowed;
            transform: none;
        }

        #send-btn svg {
            width: 18px;
            height: 18px;
            fill: white;
        }

        /* --- Quick Actions --- */
        .quick-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #f0f0f0; /* Separator for quick actions */
        }

        .quick-action-btn {
            padding: 8px 14px;
            background: #e9f0f9; /* Light blue background */
            border: 1px solid var(--primary-color-start);
            color: var(--primary-color-start);
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quick-action-btn:hover {
            background: var(--primary-color-start);
            color: white;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
        }

        /* --- Mobile Responsive --- */
        @media (max-width: 420px) { /* Adjusted breakpoint for common mobile widths */
            #chatbot-widget {
                width: 90vw; /* Take up more width */
                height: 80vh; /* Take up most of the viewport height */
                right: 5vw; /* Centered */
                bottom: 80px;
            }

            #chatbot-button {
                bottom: 20px;
                right: 20px;
            }
        }
    </style>
</head>
<body>
    <button id="chatbot-button" aria-label="Open chat">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/>
        </svg>
    </button>

    <div id="chatbot-widget">
        <div id="chatbot-header">
            <div>
                <h3>Nirma Assistant</h3>
                <p>Ask me anything about Nirma University</p>
            </div>
            <button id="close-btn" aria-label="Close chat">×</button>
        </div>

        <div id="chat-messages">
            <div class="message bot">
                <div class="message-avatar">A</div> 
                <div class="message-content">
                    Hi! 👋 I'm your **Nirma University Assistant**. I can help you with information about admissions, courses, campus life, and more. How can I help you today?
                    <div class="quick-actions">
                        <button class="quick-action-btn" data-question="What are the admission requirements?">Admissions</button>
                        <button class="quick-action-btn" data-question="Tell me about the courses offered">Courses</button>
                        <button class="quick-action-btn" data-question="How is campus life?">Campus Life</button>
                        <button class="quick-action-btn" data-question="What about placements?">Placements</button>
                    </div>
                </div>
            </div>
            <div class="typing-indicator">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>

        <div id="chat-input-container">
            <input 
                type="text" 
                id="chat-input" 
                placeholder="Type your message..."
                autocomplete="off"
                aria-label="Chat input field"
            />
            <button id="send-btn" aria-label="Send message" disabled>
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                </svg>
            </button>
        </div>
    </div>

    <script>
        // Configuration
        const API_URL = '/chat';
        
        // Elements
        const chatbotButton = document.getElementById('chatbot-button');
        const chatbotWidget = document.getElementById('chatbot-widget');
        const closeBtn = document.getElementById('close-btn');
        const chatMessages = document.getElementById('chat-messages');
        const chatInput = document.getElementById('chat-input');
        const sendBtn = document.getElementById('send-btn');
        const typingIndicator = document.querySelector('.typing-indicator');
        
        // State
        let isOpen = false;
        
        // Toggle chat widget
        function toggleChat() {
            isOpen = !isOpen;
            chatbotWidget.style.display = isOpen ? 'flex' : 'none';
            
            if (isOpen) {
                chatInput.focus();
                scrollToBottom();
            }
        }
        
        // Scroll to bottom of messages
        function scrollToBottom() {
            // Using requestAnimationFrame ensures the scroll happens after the DOM update
            requestAnimationFrame(() => {
                chatMessages.scrollTop = chatMessages.scrollHeight;
            });
        }
        
        // Add message to chat
        function addMessage(content, isUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;
            
            // Add bot avatar for bot messages
            if (!isUser) {
                const avatarDiv = document.createElement('div');
                avatarDiv.className = 'message-avatar';
                avatarDiv.textContent = 'A'; // 'A' for Assistant
                messageDiv.appendChild(avatarDiv);
            }
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            
            // Simple markdown parsing for a bit of style in bot response (optional but nice)
            const formattedContent = content.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            contentDiv.innerHTML = formattedContent;
            
            messageDiv.appendChild(contentDiv);
            
            // Insert before typing indicator
            chatMessages.insertBefore(messageDiv, typingIndicator);
            scrollToBottom();
        }
        
        // Show/hide typing indicator
        function showTyping(show) {
            typingIndicator.style.display = show ? 'flex' : 'none';
            if (show) scrollToBottom();
        }
        
        // Send message to API
        async function sendMessage(message) {
            const trimmedMessage = message.trim();
            if (!trimmedMessage) return;
            
            // Remove quick actions from the last bot message before adding user message
            const lastBotMessageContent = chatMessages.querySelector('.message.bot:last-of-type .message-content');
            if (lastBotMessageContent) {
                const quickActions = lastBotMessageContent.querySelector('.quick-actions');
                if (quickActions) {
                    quickActions.remove();
                    // Optional: remove the top border if it was added for quick actions
                    lastBotMessageContent.style.borderTop = 'none'; 
                }
            }


            // Add user message
            addMessage(trimmedMessage, true);
            chatInput.value = '';
            sendBtn.disabled = true;
            
            // Show typing indicator
            showTyping(true);
            
            // Simulate API call and bot response
            // NOTE: Replace this section with your actual fetch call to API_URL
            setTimeout(() => {
                showTyping(false);
                sendBtn.disabled = false;

                let botResponse = `Thank you for asking about **${trimmedMessage}**. As the Nirma University Assistant, I can confirm that information is available on the official website. For example, specific admission details can be found on the 'Admissions' page.`;
                
                if (trimmedMessage.toLowerCase().includes('placements')) {
                    botResponse = "Nirma University has an excellent placement record, with top companies across various sectors recruiting our students. The dedicated Placement Cell facilitates internships and final placements. Would you like to know the average salary or a list of top recruiters?";
                } else if (trimmedMessage.toLowerCase().includes('courses')) {
                     botResponse = "Nirma offers a diverse range of courses across various disciplines like Technology, Management, Law, and Pharmacy. Which school are you most interested in?";
                } else if (trimmedMessage.toLowerCase().includes('admission')) {
                     botResponse = "Admission requirements vary by program (B.Tech, MBA, B.Pharm, etc.). Generally, they involve competitive entrance exam scores (like JEE, CAT, GUJCET) and academic merit. Which program are you targeting?";
                } else if (trimmedMessage.toLowerCase().includes('campus life')) {
                     botResponse = "Campus life at Nirma is vibrant, featuring state-of-the-art facilities, various student clubs, and annual cultural and technical fests. You'll find a great balance of academics and extracurricular activities.";
                }

                addMessage(botResponse);
                chatInput.focus();
            }, 1500); // 1.5 second delay for a realistic typing simulation
            
            /* ORIGINAL API CALL STRUCTURE:
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ message: trimmedMessage })
                });
                
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                
                const data = await response.json();
                
                showTyping(false);
                addMessage(data.response);
                
            } catch (error) {
                console.error('Error:', error);
                showTyping(false);
                addMessage('Sorry, I encountered an error. Please try again or contact admissions@nirmauni.ac.in for assistance.');
            } finally {
                sendBtn.disabled = false;
                chatInput.focus();
            }
            */
        }
        
        // Event listeners
        chatbotButton.addEventListener('click', toggleChat);
        closeBtn.addEventListener('click', toggleChat);
        
        sendBtn.addEventListener('click', () => {
            const message = chatInput.value;
            sendMessage(message);
        });
        
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !sendBtn.disabled) {
                const message = chatInput.value;
                sendMessage(message);
            }
        });
        
        // Quick action buttons
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('quick-action-btn')) {
                const question = e.target.getAttribute('data-question');
                sendMessage(question);
            }
        });
        
        // Disable send button when input is empty
        chatInput.addEventListener('input', () => {
            sendBtn.disabled = !chatInput.value.trim();
        });
        
        // Initial setup for the disabled state
        sendBtn.disabled = !chatInput.value.trim();

        console.log('🤖 Nirma University Chatbot Widget Loaded with Modern UI');
    </script>
</body>
</html>
